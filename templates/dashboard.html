{% extends "base.html" %}

{% block title %}{{ t('dashboard.admin_title') }}{% endblock %}

{% block content %}
<div class="stats">
    <div class="stat-card">
        <div class="stat-number">{{ total_users }}</div>
        <div class="stat-label">{{ t('dashboard.statistics.total_users') }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ active_users }}</div>
        <div class="stat-label">{{ t('dashboard.statistics.active_users') }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ total_items }}</div>
        <div class="stat-label">{{ t('dashboard.statistics.total_items') }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ active_items }}</div>
        <div class="stat-label">{{ t('dashboard.statistics.active_items') }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ total_client_apps }}</div>
        <div class="stat-label">{{ t('dashboard.statistics.client_apps') }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ active_client_apps }}</div>
        <div class="stat-label">{{ t('dashboard.statistics.active_apps') }}</div>
    </div>
</div>

<div class="card">
    <h2>📊 {{ t('dashboard.overview') }}</h2>
    <p>{{ t('dashboard.welcome_admin') }}</p>
    
    <div style="margin-top: 30px;">
        <h3>{{ t('dashboard.quick_actions') }}</h3>
        <a href="/admin/users" class="btn btn-primary">👥 {{ t('dashboard.actions.manage_users') }}</a>
        <a href="/admin/items" class="btn btn-primary">📦 {{ t('dashboard.actions.manage_items') }}</a>
        <a href="/admin/client-apps" class="btn btn-primary">🔐 {{ t('dashboard.actions.client_apps') }}</a>
        <a href="/admin/users/new" class="btn btn-success">➕ {{ t('dashboard.actions.add_new_user') }}</a>
    </div>
</div>

<div class="card">
    <h3>📈 {{ t('dashboard.recent_activity') }}</h3>
    
    <h4>{{ t('dashboard.recent_users') }}</h4>
    {% if recent_users %}
        <table class="table">
            <thead>
                <tr>
                    <th>{{ t('dashboard.table.id') }}</th>
                    <th>{{ t('dashboard.table.username') }}</th>
                    <th>{{ t('dashboard.table.email') }}</th>
                    <th>{{ t('dashboard.table.role') }}</th>
                    <th>{{ t('dashboard.table.status') }}</th>
                    <th>{{ t('dashboard.table.created') }}</th>
                </tr>
            </thead>
            <tbody>
                {% for user in recent_users %}
                <tr>
                    <td>{{ user.id }}</td>
                    <td>{{ user.username }}</td>
                    <td>{{ user.email }}</td>
                    <td><span class="badge badge-{{ user.role }}">{{ user.role.title() }}</span></td>
                    <td><span class="badge badge-{{ 'active' if user.is_active else 'inactive' }}">{{ t('dashboard.status_labels.active') if user.is_active else t('dashboard.status_labels.inactive') }}</span></td>
                    <td>{{ user.created_at[:16] }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>{{ t('dashboard.no_data.no_users_found') }}</p>
    {% endif %}
    
    <div style="margin-top: 20px;">
        <a href="/admin/users" class="btn btn-primary">{{ t('dashboard.actions.view_all_users') }}</a>
    </div>
</div>

<div class="card">
    <h3>📦 {{ t('dashboard.recent_items_admin') }}</h3>
    {% if recent_items %}
        <table class="table">
            <thead>
                <tr>
                    <th>{{ t('dashboard.table.id') }}</th>
                    <th>{{ t('dashboard.table.name') }}</th>
                    <th>{{ t('dashboard.table.price') }}</th>
                    <th>{{ t('dashboard.table.status') }}</th>
                    <th>{{ t('dashboard.table.owner') }}</th>
                    <th>{{ t('dashboard.table.created') }}</th>
                </tr>
            </thead>
            <tbody>
                {% for item in recent_items %}
                <tr>
                    <td>{{ item.id }}</td>
                    <td>{{ item.name }}</td>
                    <td>${{ "%.2f"|format(item.price) }}</td>
                    <td><span class="badge badge-{{ 'active' if item.status == 'active' else 'warning' if item.status == 'draft' else 'inactive' }}">{{ item.status.title() }}</span></td>
                    <td>{{ item.owner_username or t('dashboard.status_labels.unknown') }}</td>
                    <td>{{ item.created_at[:16] }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>{{ t('dashboard.no_data.no_items_found') }}</p>
    {% endif %}
    
    <div style="margin-top: 20px;">
        <a href="/admin/items" class="btn btn-primary">{{ t('dashboard.actions.view_all_items') }}</a>
    </div>
</div>

<div class="card">
    <h3>🔐 {{ t('dashboard.client_applications') }}</h3>
    {% if recent_client_apps %}
        <table class="table">
            <thead>
                <tr>
                    <th>{{ t('dashboard.table.id') }}</th>
                    <th>{{ t('dashboard.table.name') }}</th>
                    <th>{{ t('dashboard.table.app_id') }}</th>
                    <th>{{ t('dashboard.table.status') }}</th>
                    <th>{{ t('dashboard.table.created') }}</th>
                    <th>{{ t('dashboard.table.actions') }}</th>
                </tr>
            </thead>
            <tbody>
                {% for app in recent_client_apps %}
                <tr>
                    <td>{{ app.id }}</td>
                    <td>{{ app.name }}</td>
                    <td><code style="font-size: 0.8em;">{{ app.app_id[:20] }}...</code></td>
                    <td><span class="badge badge-{{ 'active' if app.is_active else 'inactive' }}">{{ t('dashboard.status_labels.active') if app.is_active else t('dashboard.status_labels.inactive') }}</span></td>
                    <td>{{ app.created_at[:16] }}</td>
                    <td>
                        <a href="/admin/client-apps/" class="btn btn-sm" style="padding: 4px 8px; font-size: 0.8em; background: #667eea; color: white; text-decoration: none; border-radius: 4px;">{{ t('dashboard.actions.manage') }}</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div style="text-align: center; padding: 20px; color: #666;">
            <p>{{ t('dashboard.no_data.no_client_applications_found') }}</p>
            <a href="/admin/client-apps/" class="btn btn-primary">{{ t('dashboard.actions.create_first_app') }}</a>
        </div>
    {% endif %}
    
    <div style="margin-top: 20px;">
        <a href="/admin/client-apps/" class="btn btn-primary">🔐 {{ t('dashboard.actions.manage_all_client_apps') }}</a>
        <a href="/api/v1/auth/token" class="btn btn-primary" style="background: #48bb78;">📚 {{ t('dashboard.actions.api_token_endpoint') }}</a>
    </div>
</div>
{% endblock %}
